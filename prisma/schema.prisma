// -------------------------
// SMARTAPRT DATABASE SCHEMA
// -------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// -------------------------
// ROLE MODEL
// -------------------------
model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[]
}

// -------------------------
// USER MODEL
// -------------------------
model User {
  id       Int    @id @default(autoincrement())
  name     String
  email    String @unique
  password String
  roleId   Int?
  role     Role?  @relation(fields: [roleId], references: [id])

  // Apartment relationships
  units           Unit[]
  payments        Payment[]
  invoices        Invoice[]
  updates         Update[]            @relation("UserUpdates")
  uploadedDocs    Document[]
  notifications   Notification[]
  activityLogs    ActivityLog[]
  createdTickets  MaintenanceTicket[] @relation("CreatedTickets")
  assignedTickets MaintenanceTicket[] @relation("AssignedTickets")
}

// -------------------------
// APARTMENT & UNIT MODELS
// -------------------------
model Apartment {
  id      Int    @id @default(autoincrement())
  name    String
  address String
  units   Unit[]
}

model Unit {
  id          Int    @id @default(autoincrement())
  unitNumber  String
  apartmentId Int
  tenantId    Int?

  apartment Apartment @relation(fields: [apartmentId], references: [id])
  tenant    User?     @relation(fields: [tenantId], references: [id])
}

// -------------------------
// BILLING MODELS
// -------------------------
model Payment {
  id          Int      @id @default(autoincrement())
  amount      Float
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  tenantId    Int

  tenant User @relation(fields: [tenantId], references: [id])
}

model Invoice {
  id        Int      @id @default(autoincrement())
  amount    Float
  dueDate   DateTime
  status    String   @default("unpaid")
  createdAt DateTime @default(now())
  tenantId  Int

  tenant User @relation(fields: [tenantId], references: [id])
}

// -------------------------
// UPDATES & MAINTENANCE
// -------------------------
model Update {
  id        Int      @id @default(autoincrement())
  title     String
  message   String
  createdAt DateTime @default(now())
  authorId  Int

  author User @relation("UserUpdates", fields: [authorId], references: [id])
}

model MaintenanceTicket {
  id           Int      @id @default(autoincrement())
  title        String
  description  String
  status       String   @default("pending")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  createdById  Int?
  assignedToId Int?

  createdBy  User? @relation("CreatedTickets", fields: [createdById], references: [id])
  assignedTo User? @relation("AssignedTickets", fields: [assignedToId], references: [id])
}

// -------------------------
// DOCUMENTS, NOTIFICATIONS & LOGS
// -------------------------
model Document {
  id         Int      @id @default(autoincrement())
  title      String
  fileUrl    String
  uploadedBy Int?
  createdAt  DateTime @default(now())

  uploadedByUser User? @relation(fields: [uploadedBy], references: [id])
}

model Notification {
  id          Int      @id @default(autoincrement())
  message     String
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())
  recipientId Int

  recipient User @relation(fields: [recipientId], references: [id])
}

model ActivityLog {
  id        Int      @id @default(autoincrement())
  action    String
  timestamp DateTime @default(now())
  actorId   Int?

  actor User? @relation(fields: [actorId], references: [id])
}
